def adv_search_extension(q, include_extension_inputs, exclude_extension_inputs):
    for extension in include_extension_inputs:
        q = q.filter(db.Books.data.any(db.Data.format == extension))
    for extension in exclude_extension_inputs:
        q = q.filter(not_(db.Books.data.any(db.Data.format == extension)))
    return q

def __create_ac_suffix_and_output_links(self, root):  # Time:  O(n + p^2), Space: O(t + p^2)
    queue = collections.deque()
    for node in root.children.itervalues():
        queue.append(node)
        node.suffix = root

    while queue:
        node = queue.popleft()
        for c, child in node.children.iteritems():
            queue.append(child)
            suffix = node.suffix
            while suffix and c not in suffix.children:
                suffix = suffix.suffix
            child.suffix = suffix.children[c] if suffix else root
            child.outputs += child.suffix.outputs  # Time: O(p^2)
    
    return root



